<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Language Switching Functional Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        
        .test-section {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .test-case {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 15px;
            margin: 10px 0;
        }
        
        .test-result {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-weight: bold;
        }
        
        .test-result.pass {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .test-result.fail {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        .url-display {
            background: #e9ecef;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            margin: 10px 0;
        }
        
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>üåç Language Switching Functional Test</h1>
    <p>This page tests the language switching functionality for SEO redirect optimization.</p>
    
    <div class="test-section">
        <h2>Current Page Information</h2>
        <div class="url-display">
            <strong>Current URL:</strong> <span id="current-url"></span><br>
            <strong>Detected Language:</strong> <span id="detected-language"></span><br>
            <strong>Page Path:</strong> <span id="page-path"></span>
        </div>
    </div>
    
    <div class="test-section">
        <h2>Language Switching Test Cases</h2>
        
        <div class="test-case">
            <h3>Test Case 1: Root to Chinese</h3>
            <p>From root directory (/) to Chinese (/zh/)</p>
            <button onclick="testLanguageSwitch('/', 'zh')">Test Root ‚Üí Chinese</button>
            <div id="test-1-result"></div>
        </div>
        
        <div class="test-case">
            <h3>Test Case 2: Chinese to English</h3>
            <p>From Chinese (/zh/) to English (should go to root /)</p>
            <button onclick="testLanguageSwitch('/zh/', 'en')">Test Chinese ‚Üí English</button>
            <div id="test-2-result"></div>
        </div>
        
        <div class="test-case">
            <h3>Test Case 3: /en/ to Chinese</h3>
            <p>From /en/ path to Chinese (/zh/)</p>
            <button onclick="testLanguageSwitch('/en/', 'zh')">Test /en/ ‚Üí Chinese</button>
            <div id="test-3-result"></div>
        </div>
        
        <div class="test-case">
            <h3>Test Case 4: /en/ to English</h3>
            <p>From /en/ path to English (should redirect to root /)</p>
            <button onclick="testLanguageSwitch('/en/', 'en')">Test /en/ ‚Üí English</button>
            <div id="test-4-result"></div>
        </div>
        
        <div class="test-case">
            <h3>Test Case 5: Device Page Language Switch</h3>
            <p>From device page to different language</p>
            <button onclick="testLanguageSwitch('/devices/compare.html', 'zh')">Test Device Page ‚Üí Chinese</button>
            <div id="test-5-result"></div>
        </div>
    </div>
    
    <div class="test-section">
        <h2>Test Log</h2>
        <div id="test-log" class="log"></div>
        <button onclick="clearLog()">Clear Log</button>
    </div>

    <script>
        // Mock the language switching logic for testing
        function mockGetTargetUrl(currentPath, targetLang) {
            console.log(`üîç Mock testing: ${currentPath} -> ${targetLang}`);
            
            // Parse current path to extract language and page info
            const pathParts = currentPath.split('/').filter(part => part);
            
            // Determine current language and page path
            let currentLang = 'en';
            let pagePath = '';
            
            if (pathParts.length === 0) {
                // Root path (/)
                currentLang = 'en';
                pagePath = '';
            } else {
                // Check if first part is a language code
                const possibleLang = pathParts[0];
                const supportedLangs = ['en', 'zh', 'de', 'es', 'fr', 'it', 'ja', 'ko', 'pt', 'ru'];
                
                if (supportedLangs.includes(possibleLang)) {
                    currentLang = possibleLang;
                    pagePath = pathParts.slice(1).join('/');
                } else {
                    // No language prefix - treat as root English content
                    currentLang = 'en';
                    pagePath = pathParts.join('/');
                }
            }
            
            // Build target URL based on SEO-optimized structure
            let targetUrl;
            
            if (targetLang === 'en') {
                // English: ALWAYS use root path without language prefix
                if (pagePath) {
                    targetUrl = `/${pagePath}`;
                } else {
                    targetUrl = '/';
                }
            } else {
                // Other languages: use language prefix
                targetUrl = `/${targetLang}`;
                if (pagePath) {
                    targetUrl += `/${pagePath}`;
                }
                
                // Ensure trailing slash for directory-like paths
                if (!pagePath || (!pagePath.includes('.') && !pagePath.endsWith('/'))) {
                    targetUrl += '/';
                }
            }
            
            return {
                currentPath,
                currentLang,
                pagePath,
                targetLang,
                targetUrl
            };
        }
        
        function testLanguageSwitch(fromPath, toLang) {
            const result = mockGetTargetUrl(fromPath, toLang);
            const testId = `test-${Math.floor(Math.random() * 1000)}`;
            
            // Log the test
            logTest(`Test: ${fromPath} -> ${toLang}`, result);
            
            // Determine expected result
            let expected;
            let testName;
            
            if (fromPath === '/' && toLang === 'zh') {
                expected = '/zh/';
                testName = 'Root to Chinese';
            } else if (fromPath === '/zh/' && toLang === 'en') {
                expected = '/';
                testName = 'Chinese to English';
            } else if (fromPath === '/en/' && toLang === 'zh') {
                expected = '/zh/';
                testName = '/en/ to Chinese';
            } else if (fromPath === '/en/' && toLang === 'en') {
                expected = '/';
                testName = '/en/ to English (SEO redirect)';
            } else if (fromPath === '/devices/compare.html' && toLang === 'zh') {
                expected = '/zh/devices/compare.html';
                testName = 'Device Page to Chinese';
            }
            
            // Check result
            const passed = result.targetUrl === expected;
            const resultClass = passed ? 'pass' : 'fail';
            const resultText = passed ? '‚úÖ PASS' : '‚ùå FAIL';
            
            // Find the appropriate result div
            const resultDivs = document.querySelectorAll('[id$="-result"]');
            let targetDiv = null;
            
            // Simple mapping based on test cases
            if (testName.includes('Root to Chinese')) targetDiv = document.getElementById('test-1-result');
            else if (testName.includes('Chinese to English')) targetDiv = document.getElementById('test-2-result');
            else if (testName.includes('/en/ to Chinese')) targetDiv = document.getElementById('test-3-result');
            else if (testName.includes('/en/ to English')) targetDiv = document.getElementById('test-4-result');
            else if (testName.includes('Device Page')) targetDiv = document.getElementById('test-5-result');
            
            if (targetDiv) {
                targetDiv.innerHTML = `
                    <div class="test-result ${resultClass}">
                        ${resultText}: ${testName}<br>
                        Expected: ${expected}<br>
                        Got: ${result.targetUrl}<br>
                        ${passed ? 'Test passed successfully!' : 'Test failed - URL mapping incorrect'}
                    </div>
                `;
            }
        }
        
        function logTest(testName, result) {
            const log = document.getElementById('test-log');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${testName}\\n` +
                           `  Current Lang: ${result.currentLang}\\n` +
                           `  Page Path: ${result.pagePath || '(root)'}\\n` +
                           `  Target Lang: ${result.targetLang}\\n` +
                           `  Target URL: ${result.targetUrl}\\n\\n`;
            
            log.textContent += logEntry;
            log.scrollTop = log.scrollHeight;
        }
        
        function clearLog() {
            document.getElementById('test-log').textContent = '';
        }
        
        // Initialize page information
        function initPageInfo() {
            document.getElementById('current-url').textContent = window.location.href;
            document.getElementById('detected-language').textContent = 'en (mock)';
            document.getElementById('page-path').textContent = window.location.pathname;
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initPageInfo);
    </script>
</body>
</html>