<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>优化事件管理器测试页面</title>
    
    <!-- 引入必要的CSS -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/optimized-events.css">
    
    <style>
        body {
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            line-height: 1.6;
        }
        
        .test-section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
        
        .test-section h3 {
            margin-top: 0;
            color: #333;
        }
        
        .test-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 15px 0;
        }
        
        .test-btn {
            padding: 10px 20px;
            border: 1px solid #007bff;
            background: #007bff;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .test-btn:hover {
            background: #0056b3;
        }
        
        .copy-btn {
            background: #28a745;
            border-color: #28a745;
        }
        
        .copy-btn:hover {
            background: #1e7e34;
        }
        
        .performance-display {
            background: #fff;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
            font-family: monospace;
            font-size: 12px;
            border: 1px solid #ccc;
        }
        
        .tool-card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .tool-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .faq-question {
            background: #e9ecef;
            padding: 15px;
            border: none;
            width: 100%;
            text-align: left;
            cursor: pointer;
            border-radius: 4px;
            margin: 5px 0;
        }
        
        .faq-answer {
            background: white;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        
        .input-test {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        #performance-metrics {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 11px;
            max-width: 300px;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <h1>优化事件管理器测试页面</h1>
    <p>这个页面用于测试 OptimizedEventManager 的各种功能和性能优化。</p>
    
    <!-- 性能指标显示 -->
    <div id="performance-metrics">
        <div>性能指标加载中...</div>
    </div>
    
    <!-- 复制按钮测试 -->
    <div class="test-section">
        <h3>复制按钮测试</h3>
        <p>测试优化的复制功能，包括防抖和视觉反馈。</p>
        <div class="test-buttons">
            <button class="copy-btn" data-copy="这是测试文本1">复制文本1</button>
            <button class="copy-btn" data-copy="这是测试文本2">复制文本2</button>
            <button class="copy-btn" data-copy="Screen Size: 1920x1080">复制屏幕信息</button>
        </div>
    </div>
    
    <!-- 主题切换测试 -->
    <div class="test-section">
        <h3>主题切换测试</h3>
        <p>测试主题切换的优化处理。</p>
        <button id="theme-toggle" class="test-btn">切换主题</button>
    </div>
    
    <!-- 工具卡片测试 -->
    <div class="test-section">
        <h3>工具卡片点击测试</h3>
        <p>测试工具卡片的点击反馈和动画。</p>
        <div style="display: flex; flex-wrap: wrap;">
            <div class="tool-card">
                <h4>工具卡片 1</h4>
                <p>点击测试卡片动画效果</p>
            </div>
            <div class="tool-card">
                <h4>工具卡片 2</h4>
                <p>测试触摸反馈</p>
            </div>
        </div>
    </div>
    
    <!-- FAQ切换测试 -->
    <div class="test-section">
        <h3>FAQ切换测试</h3>
        <p>测试FAQ展开/收起的优化动画。</p>
        <button class="faq-question" aria-expanded="false">什么是优化事件管理器？</button>
        <div class="faq-answer">
            <p>优化事件管理器是一个专门设计用于提高网页交互性能的系统。它通过事件委托、防抖、节流等技术来减少事件处理的开销，确保用户交互的响应时间保持在最佳范围内。</p>
        </div>
        
        <button class="faq-question" aria-expanded="false">它如何提高性能？</button>
        <div class="faq-answer">
            <p>通过以下方式提高性能：1) 事件委托减少监听器数量；2) 防抖和节流控制事件触发频率；3) 长任务监控确保主线程不被阻塞；4) 被动监听器优化滚动和触摸性能。</p>
        </div>
    </div>
    
    <!-- 输入防抖测试 -->
    <div class="test-section">
        <h3>输入防抖测试</h3>
        <p>测试输入事件的防抖处理。</p>
        <input type="text" class="input-test" placeholder="输入文本测试防抖（300ms延迟）">
        <input type="search" class="input-test search-input" placeholder="搜索输入测试（500ms延迟）">
        <div id="input-feedback" style="margin-top: 10px; color: #666;"></div>
    </div>
    
    <!-- 导航链接测试 -->
    <div class="test-section">
        <h3>导航链接测试</h3>
        <p>测试导航链接的点击反馈。</p>
        <div class="test-buttons">
            <a href="#" class="nav-link test-btn">首页</a>
            <a href="#" class="nav-link test-btn">设备对比</a>
            <a href="#" class="nav-link test-btn">博客</a>
        </div>
    </div>
    
    <!-- 性能监控测试 -->
    <div class="test-section">
        <h3>性能监控测试</h3>
        <p>测试长任务检测和性能指标收集。</p>
        <div class="test-buttons">
            <button class="test-btn" onclick="createLongTask()">创建长任务（测试）</button>
            <button class="test-btn" onclick="triggerManyEvents()">触发大量事件</button>
            <button class="test-btn" onclick="showPerformanceReport()">显示性能报告</button>
        </div>
        <div id="performance-display" class="performance-display"></div>
    </div>
    
    <!-- 窗口事件测试 -->
    <div class="test-section">
        <h3>窗口事件测试</h3>
        <p>调整窗口大小或滚动页面来测试优化的窗口事件处理。</p>
        <div id="window-events-display" class="performance-display">
            窗口事件信息将在这里显示...
        </div>
    </div>

    <!-- 引入必要的JavaScript -->
    <script type="module">
        // 导入优化事件管理器
        import { initializeOptimizedEventManager, getOptimizedEventManager } from './js/optimized-event-manager.js';
        
        // 初始化事件管理器
        const eventManager = initializeOptimizedEventManager({
            enablePerformanceMonitoring: true,
            usePassiveListeners: true,
            longTaskThreshold: 50,
            debounceDelays: {
                input: 300,
                search: 500,
                resize: 100
            }
        });
        
        console.log('✅ 优化事件管理器已初始化');
        
        // 测试函数
        window.createLongTask = function() {
            console.log('🔄 创建长任务测试...');
            const start = performance.now();
            // 模拟长任务（超过50ms）
            while (performance.now() - start < 100) {
                // 空循环模拟CPU密集任务
            }
            console.log('✅ 长任务完成');
        };
        
        window.triggerManyEvents = function() {
            console.log('🔄 触发大量事件测试...');
            const testElement = document.querySelector('.copy-btn');
            
            // 快速触发多个点击事件
            for (let i = 0; i < 10; i++) {
                setTimeout(() => {
                    testElement.click();
                }, i * 50);
            }
        };
        
        window.showPerformanceReport = function() {
            const manager = getOptimizedEventManager();
            if (manager) {
                const metrics = manager.getPerformanceMetrics();
                const display = document.getElementById('performance-display');
                
                display.innerHTML = `
                    <h4>性能指标报告</h4>
                    <p><strong>总事件数:</strong> ${metrics.totalEvents}</p>
                    <p><strong>长任务数:</strong> ${metrics.longTasks.length}</p>
                    <p><strong>活跃监听器:</strong> ${metrics.activeListeners}</p>
                    <p><strong>防抖定时器:</strong> ${metrics.activeDebounceTimers}</p>
                    <p><strong>节流状态:</strong> ${metrics.activeThrottleStates}</p>
                    <p><strong>平均事件持续时间:</strong></p>
                    <pre>${JSON.stringify(metrics.averageDurations, null, 2)}</pre>
                    <p><strong>最近的长任务:</strong></p>
                    <pre>${JSON.stringify(metrics.longTasks.slice(-3), null, 2)}</pre>
                `;
            }
        };
        
        // 输入反馈测试
        const inputFeedback = document.getElementById('input-feedback');
        let inputCount = 0;
        
        document.addEventListener('input', (event) => {
            if (event.target.classList.contains('input-test')) {
                inputCount++;
                inputFeedback.textContent = `输入事件 #${inputCount}: "${event.target.value}" (防抖处理中...)`;
            }
        });
        
        // 窗口事件显示
        const windowEventsDisplay = document.getElementById('window-events-display');
        let resizeCount = 0;
        let scrollCount = 0;
        
        window.addEventListener('optimizedResize', (event) => {
            resizeCount++;
            updateWindowEventsDisplay();
        });
        
        window.addEventListener('scroll', () => {
            scrollCount++;
            updateWindowEventsDisplay();
        });
        
        function updateWindowEventsDisplay() {
            windowEventsDisplay.innerHTML = `
                <strong>窗口事件统计:</strong><br>
                调整大小事件: ${resizeCount}<br>
                滚动事件: ${scrollCount}<br>
                当前窗口大小: ${window.innerWidth} × ${window.innerHeight}<br>
                滚动位置: ${window.pageYOffset}px
            `;
        }
        
        // 实时性能指标更新
        function updatePerformanceMetrics() {
            const manager = getOptimizedEventManager();
            if (manager) {
                const metrics = manager.getPerformanceMetrics();
                const display = document.getElementById('performance-metrics');
                
                display.innerHTML = `
                    <div><strong>实时性能指标</strong></div>
                    <div>总事件: ${metrics.totalEvents}</div>
                    <div>长任务: ${metrics.longTasks.length}</div>
                    <div>活跃监听器: ${metrics.activeListeners}</div>
                    <div>防抖定时器: ${metrics.activeDebounceTimers}</div>
                `;
            }
        }
        
        // 每秒更新性能指标
        setInterval(updatePerformanceMetrics, 1000);
        
        // 初始化显示
        updateWindowEventsDisplay();
        updatePerformanceMetrics();
        
        console.log('✅ 测试页面初始化完成');
    </script>
</body>
</html>