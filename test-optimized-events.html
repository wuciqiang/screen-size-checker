<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¼˜åŒ–äº‹ä»¶ç®¡ç†å™¨æµ‹è¯•é¡µé¢</title>
    
    <!-- å¼•å…¥å¿…è¦çš„CSS -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/optimized-events.css">
    
    <style>
        body {
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            line-height: 1.6;
        }
        
        .test-section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
        
        .test-section h3 {
            margin-top: 0;
            color: #333;
        }
        
        .test-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 15px 0;
        }
        
        .test-btn {
            padding: 10px 20px;
            border: 1px solid #007bff;
            background: #007bff;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .test-btn:hover {
            background: #0056b3;
        }
        
        .copy-btn {
            background: #28a745;
            border-color: #28a745;
        }
        
        .copy-btn:hover {
            background: #1e7e34;
        }
        
        .performance-display {
            background: #fff;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
            font-family: monospace;
            font-size: 12px;
            border: 1px solid #ccc;
        }
        
        .tool-card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .tool-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .faq-question {
            background: #e9ecef;
            padding: 15px;
            border: none;
            width: 100%;
            text-align: left;
            cursor: pointer;
            border-radius: 4px;
            margin: 5px 0;
        }
        
        .faq-answer {
            background: white;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        
        .input-test {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        #performance-metrics {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 11px;
            max-width: 300px;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <h1>ä¼˜åŒ–äº‹ä»¶ç®¡ç†å™¨æµ‹è¯•é¡µé¢</h1>
    <p>è¿™ä¸ªé¡µé¢ç”¨äºæµ‹è¯• OptimizedEventManager çš„å„ç§åŠŸèƒ½å’Œæ€§èƒ½ä¼˜åŒ–ã€‚</p>
    
    <!-- æ€§èƒ½æŒ‡æ ‡æ˜¾ç¤º -->
    <div id="performance-metrics">
        <div>æ€§èƒ½æŒ‡æ ‡åŠ è½½ä¸­...</div>
    </div>
    
    <!-- å¤åˆ¶æŒ‰é’®æµ‹è¯• -->
    <div class="test-section">
        <h3>å¤åˆ¶æŒ‰é’®æµ‹è¯•</h3>
        <p>æµ‹è¯•ä¼˜åŒ–çš„å¤åˆ¶åŠŸèƒ½ï¼ŒåŒ…æ‹¬é˜²æŠ–å’Œè§†è§‰åé¦ˆã€‚</p>
        <div class="test-buttons">
            <button class="copy-btn" data-copy="è¿™æ˜¯æµ‹è¯•æ–‡æœ¬1">å¤åˆ¶æ–‡æœ¬1</button>
            <button class="copy-btn" data-copy="è¿™æ˜¯æµ‹è¯•æ–‡æœ¬2">å¤åˆ¶æ–‡æœ¬2</button>
            <button class="copy-btn" data-copy="Screen Size: 1920x1080">å¤åˆ¶å±å¹•ä¿¡æ¯</button>
        </div>
    </div>
    
    <!-- ä¸»é¢˜åˆ‡æ¢æµ‹è¯• -->
    <div class="test-section">
        <h3>ä¸»é¢˜åˆ‡æ¢æµ‹è¯•</h3>
        <p>æµ‹è¯•ä¸»é¢˜åˆ‡æ¢çš„ä¼˜åŒ–å¤„ç†ã€‚</p>
        <button id="theme-toggle" class="test-btn">åˆ‡æ¢ä¸»é¢˜</button>
    </div>
    
    <!-- å·¥å…·å¡ç‰‡æµ‹è¯• -->
    <div class="test-section">
        <h3>å·¥å…·å¡ç‰‡ç‚¹å‡»æµ‹è¯•</h3>
        <p>æµ‹è¯•å·¥å…·å¡ç‰‡çš„ç‚¹å‡»åé¦ˆå’ŒåŠ¨ç”»ã€‚</p>
        <div style="display: flex; flex-wrap: wrap;">
            <div class="tool-card">
                <h4>å·¥å…·å¡ç‰‡ 1</h4>
                <p>ç‚¹å‡»æµ‹è¯•å¡ç‰‡åŠ¨ç”»æ•ˆæœ</p>
            </div>
            <div class="tool-card">
                <h4>å·¥å…·å¡ç‰‡ 2</h4>
                <p>æµ‹è¯•è§¦æ‘¸åé¦ˆ</p>
            </div>
        </div>
    </div>
    
    <!-- FAQåˆ‡æ¢æµ‹è¯• -->
    <div class="test-section">
        <h3>FAQåˆ‡æ¢æµ‹è¯•</h3>
        <p>æµ‹è¯•FAQå±•å¼€/æ”¶èµ·çš„ä¼˜åŒ–åŠ¨ç”»ã€‚</p>
        <button class="faq-question" aria-expanded="false">ä»€ä¹ˆæ˜¯ä¼˜åŒ–äº‹ä»¶ç®¡ç†å™¨ï¼Ÿ</button>
        <div class="faq-answer">
            <p>ä¼˜åŒ–äº‹ä»¶ç®¡ç†å™¨æ˜¯ä¸€ä¸ªä¸“é—¨è®¾è®¡ç”¨äºæé«˜ç½‘é¡µäº¤äº’æ€§èƒ½çš„ç³»ç»Ÿã€‚å®ƒé€šè¿‡äº‹ä»¶å§”æ‰˜ã€é˜²æŠ–ã€èŠ‚æµç­‰æŠ€æœ¯æ¥å‡å°‘äº‹ä»¶å¤„ç†çš„å¼€é”€ï¼Œç¡®ä¿ç”¨æˆ·äº¤äº’çš„å“åº”æ—¶é—´ä¿æŒåœ¨æœ€ä½³èŒƒå›´å†…ã€‚</p>
        </div>
        
        <button class="faq-question" aria-expanded="false">å®ƒå¦‚ä½•æé«˜æ€§èƒ½ï¼Ÿ</button>
        <div class="faq-answer">
            <p>é€šè¿‡ä»¥ä¸‹æ–¹å¼æé«˜æ€§èƒ½ï¼š1) äº‹ä»¶å§”æ‰˜å‡å°‘ç›‘å¬å™¨æ•°é‡ï¼›2) é˜²æŠ–å’ŒèŠ‚æµæ§åˆ¶äº‹ä»¶è§¦å‘é¢‘ç‡ï¼›3) é•¿ä»»åŠ¡ç›‘æ§ç¡®ä¿ä¸»çº¿ç¨‹ä¸è¢«é˜»å¡ï¼›4) è¢«åŠ¨ç›‘å¬å™¨ä¼˜åŒ–æ»šåŠ¨å’Œè§¦æ‘¸æ€§èƒ½ã€‚</p>
        </div>
    </div>
    
    <!-- è¾“å…¥é˜²æŠ–æµ‹è¯• -->
    <div class="test-section">
        <h3>è¾“å…¥é˜²æŠ–æµ‹è¯•</h3>
        <p>æµ‹è¯•è¾“å…¥äº‹ä»¶çš„é˜²æŠ–å¤„ç†ã€‚</p>
        <input type="text" class="input-test" placeholder="è¾“å…¥æ–‡æœ¬æµ‹è¯•é˜²æŠ–ï¼ˆ300mså»¶è¿Ÿï¼‰">
        <input type="search" class="input-test search-input" placeholder="æœç´¢è¾“å…¥æµ‹è¯•ï¼ˆ500mså»¶è¿Ÿï¼‰">
        <div id="input-feedback" style="margin-top: 10px; color: #666;"></div>
    </div>
    
    <!-- å¯¼èˆªé“¾æ¥æµ‹è¯• -->
    <div class="test-section">
        <h3>å¯¼èˆªé“¾æ¥æµ‹è¯•</h3>
        <p>æµ‹è¯•å¯¼èˆªé“¾æ¥çš„ç‚¹å‡»åé¦ˆã€‚</p>
        <div class="test-buttons">
            <a href="#" class="nav-link test-btn">é¦–é¡µ</a>
            <a href="#" class="nav-link test-btn">è®¾å¤‡å¯¹æ¯”</a>
            <a href="#" class="nav-link test-btn">åšå®¢</a>
        </div>
    </div>
    
    <!-- æ€§èƒ½ç›‘æ§æµ‹è¯• -->
    <div class="test-section">
        <h3>æ€§èƒ½ç›‘æ§æµ‹è¯•</h3>
        <p>æµ‹è¯•é•¿ä»»åŠ¡æ£€æµ‹å’Œæ€§èƒ½æŒ‡æ ‡æ”¶é›†ã€‚</p>
        <div class="test-buttons">
            <button class="test-btn" onclick="createLongTask()">åˆ›å»ºé•¿ä»»åŠ¡ï¼ˆæµ‹è¯•ï¼‰</button>
            <button class="test-btn" onclick="triggerManyEvents()">è§¦å‘å¤§é‡äº‹ä»¶</button>
            <button class="test-btn" onclick="showPerformanceReport()">æ˜¾ç¤ºæ€§èƒ½æŠ¥å‘Š</button>
        </div>
        <div id="performance-display" class="performance-display"></div>
    </div>
    
    <!-- çª—å£äº‹ä»¶æµ‹è¯• -->
    <div class="test-section">
        <h3>çª—å£äº‹ä»¶æµ‹è¯•</h3>
        <p>è°ƒæ•´çª—å£å¤§å°æˆ–æ»šåŠ¨é¡µé¢æ¥æµ‹è¯•ä¼˜åŒ–çš„çª—å£äº‹ä»¶å¤„ç†ã€‚</p>
        <div id="window-events-display" class="performance-display">
            çª—å£äº‹ä»¶ä¿¡æ¯å°†åœ¨è¿™é‡Œæ˜¾ç¤º...
        </div>
    </div>

    <!-- å¼•å…¥å¿…è¦çš„JavaScript -->
    <script type="module">
        // å¯¼å…¥ä¼˜åŒ–äº‹ä»¶ç®¡ç†å™¨
        import { initializeOptimizedEventManager, getOptimizedEventManager } from './js/optimized-event-manager.js';
        
        // åˆå§‹åŒ–äº‹ä»¶ç®¡ç†å™¨
        const eventManager = initializeOptimizedEventManager({
            enablePerformanceMonitoring: true,
            usePassiveListeners: true,
            longTaskThreshold: 50,
            debounceDelays: {
                input: 300,
                search: 500,
                resize: 100
            }
        });
        
        console.log('âœ… ä¼˜åŒ–äº‹ä»¶ç®¡ç†å™¨å·²åˆå§‹åŒ–');
        
        // æµ‹è¯•å‡½æ•°
        window.createLongTask = function() {
            console.log('ğŸ”„ åˆ›å»ºé•¿ä»»åŠ¡æµ‹è¯•...');
            const start = performance.now();
            // æ¨¡æ‹Ÿé•¿ä»»åŠ¡ï¼ˆè¶…è¿‡50msï¼‰
            while (performance.now() - start < 100) {
                // ç©ºå¾ªç¯æ¨¡æ‹ŸCPUå¯†é›†ä»»åŠ¡
            }
            console.log('âœ… é•¿ä»»åŠ¡å®Œæˆ');
        };
        
        window.triggerManyEvents = function() {
            console.log('ğŸ”„ è§¦å‘å¤§é‡äº‹ä»¶æµ‹è¯•...');
            const testElement = document.querySelector('.copy-btn');
            
            // å¿«é€Ÿè§¦å‘å¤šä¸ªç‚¹å‡»äº‹ä»¶
            for (let i = 0; i < 10; i++) {
                setTimeout(() => {
                    testElement.click();
                }, i * 50);
            }
        };
        
        window.showPerformanceReport = function() {
            const manager = getOptimizedEventManager();
            if (manager) {
                const metrics = manager.getPerformanceMetrics();
                const display = document.getElementById('performance-display');
                
                display.innerHTML = `
                    <h4>æ€§èƒ½æŒ‡æ ‡æŠ¥å‘Š</h4>
                    <p><strong>æ€»äº‹ä»¶æ•°:</strong> ${metrics.totalEvents}</p>
                    <p><strong>é•¿ä»»åŠ¡æ•°:</strong> ${metrics.longTasks.length}</p>
                    <p><strong>æ´»è·ƒç›‘å¬å™¨:</strong> ${metrics.activeListeners}</p>
                    <p><strong>é˜²æŠ–å®šæ—¶å™¨:</strong> ${metrics.activeDebounceTimers}</p>
                    <p><strong>èŠ‚æµçŠ¶æ€:</strong> ${metrics.activeThrottleStates}</p>
                    <p><strong>å¹³å‡äº‹ä»¶æŒç»­æ—¶é—´:</strong></p>
                    <pre>${JSON.stringify(metrics.averageDurations, null, 2)}</pre>
                    <p><strong>æœ€è¿‘çš„é•¿ä»»åŠ¡:</strong></p>
                    <pre>${JSON.stringify(metrics.longTasks.slice(-3), null, 2)}</pre>
                `;
            }
        };
        
        // è¾“å…¥åé¦ˆæµ‹è¯•
        const inputFeedback = document.getElementById('input-feedback');
        let inputCount = 0;
        
        document.addEventListener('input', (event) => {
            if (event.target.classList.contains('input-test')) {
                inputCount++;
                inputFeedback.textContent = `è¾“å…¥äº‹ä»¶ #${inputCount}: "${event.target.value}" (é˜²æŠ–å¤„ç†ä¸­...)`;
            }
        });
        
        // çª—å£äº‹ä»¶æ˜¾ç¤º
        const windowEventsDisplay = document.getElementById('window-events-display');
        let resizeCount = 0;
        let scrollCount = 0;
        
        window.addEventListener('optimizedResize', (event) => {
            resizeCount++;
            updateWindowEventsDisplay();
        });
        
        window.addEventListener('scroll', () => {
            scrollCount++;
            updateWindowEventsDisplay();
        });
        
        function updateWindowEventsDisplay() {
            windowEventsDisplay.innerHTML = `
                <strong>çª—å£äº‹ä»¶ç»Ÿè®¡:</strong><br>
                è°ƒæ•´å¤§å°äº‹ä»¶: ${resizeCount}<br>
                æ»šåŠ¨äº‹ä»¶: ${scrollCount}<br>
                å½“å‰çª—å£å¤§å°: ${window.innerWidth} Ã— ${window.innerHeight}<br>
                æ»šåŠ¨ä½ç½®: ${window.pageYOffset}px
            `;
        }
        
        // å®æ—¶æ€§èƒ½æŒ‡æ ‡æ›´æ–°
        function updatePerformanceMetrics() {
            const manager = getOptimizedEventManager();
            if (manager) {
                const metrics = manager.getPerformanceMetrics();
                const display = document.getElementById('performance-metrics');
                
                display.innerHTML = `
                    <div><strong>å®æ—¶æ€§èƒ½æŒ‡æ ‡</strong></div>
                    <div>æ€»äº‹ä»¶: ${metrics.totalEvents}</div>
                    <div>é•¿ä»»åŠ¡: ${metrics.longTasks.length}</div>
                    <div>æ´»è·ƒç›‘å¬å™¨: ${metrics.activeListeners}</div>
                    <div>é˜²æŠ–å®šæ—¶å™¨: ${metrics.activeDebounceTimers}</div>
                `;
            }
        }
        
        // æ¯ç§’æ›´æ–°æ€§èƒ½æŒ‡æ ‡
        setInterval(updatePerformanceMetrics, 1000);
        
        // åˆå§‹åŒ–æ˜¾ç¤º
        updateWindowEventsDisplay();
        updatePerformanceMetrics();
        
        console.log('âœ… æµ‹è¯•é¡µé¢åˆå§‹åŒ–å®Œæˆ');
    </script>
</body>
</html>