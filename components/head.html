<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Google Analytics - Defer loading -->
<script>
// Defer Google Analytics loading
window.addEventListener('load', function() {
    setTimeout(function() {
        var script = document.createElement('script');
        script.async = true;
        script.src = 'https://www.googletagmanager.com/gtag/js?id=G-X0YSSZGWMX';
        document.head.appendChild(script);
        
        script.onload = function() {
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'G-X0YSSZGWMX');
        };
    }, 1000); // Delay 1 second after page load
});

</script>

<!-- SEO Meta Tags -->
<title data-i18n="title">{{page_title}}</title>
<meta name="description" data-i18n="seo_description" content="{{description}}">
<meta name="keywords" content="{{page_keywords}}">

<!-- Canonical URL -->
<link rel="canonical" href="{{canonical_url}}">

<!-- Hreflang tags for multilingual SEO -->
<link rel="alternate" hreflang="en" href="{{hreflang_root_url}}">
<link rel="alternate" hreflang="en-US" href="{{hreflang_en_url}}">
<link rel="alternate" hreflang="zh" href="{{hreflang_zh_url}}">
<link rel="alternate" hreflang="x-default" href="{{hreflang_root_url}}">

<!-- Open Graph -->
<meta property="og:title" content="{{og_title}}">
<meta property="og:description" content="{{og_description}}">
<meta property="og:type" content="{{og_type}}">
<meta property="og:url" content="{{og_url}}">

<!-- Font Loading Optimization (downgrade to dns-prefetch to reduce early connections) -->
<link rel="dns-prefetch" href="https://fonts.googleapis.com">
<link rel="dns-prefetch" href="https://fonts.gstatic.com">

<!-- Critical CSS - Load immediately -->
<link rel="stylesheet" href="{{css_path}}/main.css">

<!-- Mobile Performance CSS - Load with high priority for mobile optimization -->
<link rel="preload" href="{{css_path}}/mobile-performance.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="{{css_path}}/mobile-performance.css"></noscript>

<!-- Non-critical CSS - Load with lower priority -->
<link rel="preload" href="{{css_path}}/language-selector.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="{{css_path}}/language-selector.css"></noscript>

<link rel="preload" href="{{css_path}}/internal-links.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="{{css_path}}/internal-links.css"></noscript>

<link rel="preload" href="{{css_path}}/optimized-events.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="{{css_path}}/optimized-events.css"></noscript>

<link rel="preload" href="https://cdn.jsdelivr.net/npm/flag-icons@7.2.1/css/flag-icons.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flag-icons@7.2.1/css/flag-icons.min.css"></noscript>

<!-- Preload current language file only -->
<link rel="preload" href="{{locales_path}}/{{lang}}/translation.json" as="fetch" crossorigin="anonymous">
<!-- Inline Critical CSS for immediate rendering -->
<style>
/* Critical CSS for immediate rendering - prevents FOUC */
:root {
	--primary-color: #0066cc;
	--text-primary: #1a1a1a;
	--text-secondary: #666666;
	--background-primary: #ffffff;
	--background-secondary: #f8f9fa;
	--background-card: #ffffff;
	--border-color: #e1e5e9;
	--shadow-light: 0 2px 8px rgba(0, 0, 0, 0.04);
	--spacing-md: 1rem;
	--spacing-lg: 1.5rem;
	--spacing-xl: 2rem;
	--spacing-2xl: 3rem;
	--spacing-3xl: 4rem;
	--radius-lg: 12px;
	--transition-fast: 0.15s ease;
	--transition-medium: 0.25s ease;
	
	/* Font optimization variables */
	--font-family-system: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
	--font-family-mono: "SF Mono", Monaco, "Cascadia Code", "Roboto Mono", Consolas, "Courier New", monospace;
	--font-family-fallback: Arial, sans-serif;
	--font-family-mono-fallback: "Courier New", monospace;
}

/* Font display optimization */
@font-face {
	font-display: swap;
}

/* Font loading states */
.font-loading {
	visibility: hidden;
}

.font-loaded,
.font-fallback-active {
	visibility: visible;
}

/* Font fallback styles */
.font-fallback-active * {
	font-family: var(--font-family-fallback) !important;
}

.font-fallback-active code,
.font-fallback-active pre,
.font-fallback-active .code,
.font-fallback-active .mono {
	font-family: var(--font-family-mono-fallback) !important;
}

/* Dark Theme Support */
[data-theme="dark"] {
	--primary-color: #4a9eff;
	--text-primary: #e1e5e9;
	--text-secondary: #a0a0a0;
	--background-primary: #1a1a1a;
	--background-secondary: #2d2d2d;
	--background-card: #2d2d2d;
	--border-color: #404040;
	--shadow-light: 0 2px 8px rgba(0, 0, 0, 0.3);
}

[data-theme="dark"] .header {
	background: rgba(26, 26, 26, 0.95);
	border-bottom-color: var(--border-color);
}

* { margin: 0; padding: 0; box-sizing: border-box; }

/* MINIMAL LAYOUT STABILIZATION ONLY */
.header {
	position: fixed;
	top: 0;
	left: 0;
	right: 0;
	height: 64px;
	z-index: 1000;
}

.main-content {
	margin-top: 64px;
}

/* Ensure body can scroll properly */
html, body {
	overflow-x: hidden;
}
</style>

<!-- Inline Critical JavaScript for immediate screen detection -->
<script>
// Immediate screen detection - optimized for performance
(function() {
    'use strict';

    // Cache elements to avoid repeated DOM queries
    let elements = {};
    let lastViewport = '';
    let resizeTimeout;

    function cacheElements() {
        elements = {
            viewport: document.getElementById('viewport-display'),
            resolution: document.getElementById('screen-resolution-display'),
            dpr: document.getElementById('dpr'),
            aspect: document.getElementById('aspect-ratio'),
            colorDepth: document.getElementById('color-depth')
        };
    }

    function updateScreenInfo() {
        const viewport = window.innerWidth + ' √ó ' + window.innerHeight;
        const resolution = screen.width + ' √ó ' + screen.height;
        const dpr = window.devicePixelRatio || 1;
        const aspectRatio = (window.innerWidth / window.innerHeight).toFixed(2);

        // Only update viewport if it changed (avoid unnecessary DOM updates)
        if (elements.viewport && viewport !== lastViewport) {
            elements.viewport.textContent = viewport;
            lastViewport = viewport;
        }

        // Update screen resolution with optimized DOM manipulation
        if (elements.resolution) {
            // Use textContent instead of innerHTML for better performance
            if (!elements.resolution.hasAttribute('data-initialized')) {
                elements.resolution.innerHTML = '<span data-i18n="screen_resolution">Screen Resolution</span>: ' + resolution;
                elements.resolution.setAttribute('data-initialized', 'true');
            } else {
                // Only update the value part, not the label
                const valueSpan = elements.resolution.querySelector('span:nth-child(2)');
                if (valueSpan) {
                    valueSpan.textContent = resolution;
                } else {
                    // Fallback if structure changed
                    elements.resolution.innerHTML = '<span data-i18n="screen_resolution">Screen Resolution</span>: ' + resolution;
                }
            }
        }

        // Update other critical info with textContent for better performance
        if (elements.dpr) elements.dpr.textContent = dpr + 'x';
        if (elements.aspect) elements.aspect.textContent = aspectRatio + ':1';
        if (elements.colorDepth) elements.colorDepth.textContent = screen.colorDepth + ' bits';
    }

    // Optimized resize handler with debouncing
    function debouncedUpdate() {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(updateScreenInfo, 16); // ~60fps
    }

    // Initialize immediately if elements exist, or wait for DOM
    function init() {
        cacheElements();
        updateScreenInfo();

        // Set up event listeners
        window.addEventListener('resize', debouncedUpdate, { passive: true });

        // Mark page as loaded for progressive enhancement
        window.addEventListener('load', function() {
            document.body.classList.add('loaded');
            // Re-cache elements in case DOM changed
            cacheElements();
            updateScreenInfo();
        }, { once: true });
    }

    // Run immediately when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
    } else {
        init();
    }
})();
</script>

<!-- Fallback Theme Toggle Script - Critical for theme switching -->
<script>
// Fallback theme toggle function - ensures theme switching works even if main app.js fails
(function() {
    'use strict';
    
    console.log('üõ°Ô∏è Initializing fallback theme system...');
    
    // Initialize theme from localStorage or default to light
    function initializeTheme() {
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);
        updateThemeIcon(savedTheme);
        console.log('üé® Fallback theme initialized:', savedTheme);
    }
    
    // Apply theme to document
    function applyTheme(theme) {
        console.log('üé® Fallback applying theme:', theme);
        document.documentElement.setAttribute('data-theme', theme);
        localStorage.setItem('theme', theme);
        updateThemeIcon(theme);
        
        // Trigger custom event
        window.dispatchEvent(new CustomEvent('themeChanged', {
            detail: { newTheme: theme }
        }));
        
        console.log('‚úÖ Fallback theme applied successfully:', theme);
    }
    
    // Update theme icon
    function updateThemeIcon(theme) {
        const themeIcon = document.querySelector('.theme-icon');
        if (themeIcon) {
            themeIcon.textContent = theme === 'light' ? 'üåô' : '‚òÄÔ∏è';
        }
    }
    
    // Toggle theme function
    function toggleTheme() {
        const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
        const newTheme = currentTheme === 'light' ? 'dark' : 'light';
        console.log('üé® Fallback toggling theme:', currentTheme, '->', newTheme);
        applyTheme(newTheme);
    }
    
    // Expose functions globally for compatibility and debugging
    window.fallbackToggleTheme = toggleTheme;
    window.fallbackApplyTheme = applyTheme;
    window.fallbackInitializeTheme = initializeTheme;
    
    console.log('‚úÖ Functions exposed to global scope');
    console.log('fallbackToggleTheme type:', typeof window.fallbackToggleTheme);
    
    // Initialize theme immediately
    initializeTheme();
    
    // Setup theme toggle button when DOM is ready
    function setupThemeToggle() {
        const themeToggle = document.getElementById('theme-toggle');
        if (themeToggle) {
            console.log('‚úÖ Found theme toggle button, setting up fallback handler');
            
            // Add our fallback click handler with high priority
            themeToggle.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('üéØ Fallback theme toggle clicked');
                
                // Always use fallback for reliability
                toggleTheme();
            }, true); // Use capture phase for higher priority
            
            console.log('‚úÖ Fallback theme toggle setup completed');
        } else {
            console.warn('‚ö†Ô∏è Theme toggle button not found, will retry...');
            setTimeout(setupThemeToggle, 100);
        }
    }
    
    // Setup when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', setupThemeToggle);
    } else {
        setupThemeToggle();
    }
    
    console.log('üõ°Ô∏è Fallback theme system initialized successfully');
})();
</script>

<!-- UAParser.js for detailed device detection - defer to avoid blocking -->
<script defer src="https://cdn.jsdelivr.net/npm/ua-parser-js@1.0.37/dist/ua-parser.min.js"></script>

<!-- i18next Libraries - Defer non-critical -->
<script defer src="https://cdn.jsdelivr.net/npm/i18next@24.2.3/dist/umd/i18next.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/i18next-http-backend@3.0.2/i18nextHttpBackend.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/i18next-browser-languagedetector@8.0.4/i18nextBrowserLanguageDetector.min.js"></script>

<!-- Plausible Analytics - Defer loading -->
<script defer data-domain="screensizechecker.com" src="https://plausible.io/js/script.outbound-links.js"></script>

<!-- Google Ads - Defer loading -->
<script>
// Defer Google Ads loading
window.addEventListener('load', function() {
    setTimeout(function() {
        var script = document.createElement('script');
        script.async = true;
        script.src = 'https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9212629010224868';
        script.crossOrigin = 'anonymous';
        document.head.appendChild(script);
    }, 2000); // Delay 2 seconds after page load
});
</script>

<!-- Structured Data -->
<script type="application/ld+json">
{{structured_data}}
</script>

<!-- FAQ Structured Data (for responsive-tester page) -->
{{faq_structured_data}} 