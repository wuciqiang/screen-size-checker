<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ€§èƒ½ç›‘æ§åŸç†æ¼”ç¤º</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.8;
        }
        
        .analogy-box {
            background: #f0f8ff;
            border-left: 4px solid #007bff;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .code-example {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            padding: 15px;
            font-family: 'Consolas', monospace;
            margin: 15px 0;
        }
        
        .status-good { color: #28a745; font-weight: bold; }
        .status-warning { color: #ffc107; font-weight: bold; }
        .status-danger { color: #dc3545; font-weight: bold; }
        
        .demo-section {
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        
        button:hover { background: #0056b3; }
        
        .monitor-display {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            margin: 10px 0;
            min-height: 100px;
        }
    </style>
</head>
<body>
    <h1>ğŸ¥ æ€§èƒ½ç›‘æ§ç³»ç»ŸåŸç†æ¼”ç¤º</h1>
    
    <div class="analogy-box">
        <h3>ğŸ©º ç”Ÿæ´»ç±»æ¯”ï¼šç½‘ç«™ = ç—…äººï¼Œæ€§èƒ½ç›‘æ§ = åŒ»ç–—è®¾å¤‡</h3>
        <p>å°±åƒåŒ»é™¢ç”¨å„ç§è®¾å¤‡ç›‘æ§ç—…äººå¥åº·ï¼Œæˆ‘ä»¬ç”¨æ€§èƒ½ç›‘æ§ç³»ç»Ÿç›‘æ§ç½‘ç«™å¥åº·ï¼</p>
    </div>
    
    <div class="demo-section">
        <h3>1. ğŸ“Š "ç”Ÿå‘½ä½“å¾"ç›‘æ§é¢æ¿</h3>
        <p>å°±åƒåŒ»é™¢çš„ç›‘æŠ¤ä»ªæ˜¾ç¤ºç—…äººçš„å¿ƒç‡ã€è¡€å‹ç­‰ï¼š</p>
        
        <div class="monitor-display" id="vitals-display">
            æ­£åœ¨åˆå§‹åŒ–ç›‘æŠ¤è®¾å¤‡...
        </div>
        
        <button onclick="checkVitals()">ğŸ” æ£€æŸ¥ç”Ÿå‘½ä½“å¾</button>
        <button onclick="simulateEmergency()">ğŸš¨ æ¨¡æ‹Ÿç´§æ€¥æƒ…å†µ</button>
    </div>
    
    <div class="demo-section">
        <h3>2. ğŸ”” æŠ¥è­¦ç³»ç»Ÿæ¼”ç¤º</h3>
        <p>å½“ç½‘ç«™"ç”Ÿç—…"æ—¶ï¼ˆæ€§èƒ½å˜å·®ï¼‰ï¼Œç³»ç»Ÿä¼šåƒåŒ»é™¢æŠ¥è­¦å™¨ä¸€æ ·æé†’æˆ‘ä»¬ï¼š</p>
        
        <div class="code-example">
            æ­£å¸¸èŒƒå›´è®¾å®šï¼š<br>
            â€¢ LCP (å¿ƒç‡) â‰¤ 2.5ç§’ âœ…<br>
            â€¢ FID (ååº”é€Ÿåº¦) â‰¤ 100æ¯«ç§’ âœ…<br>
            â€¢ CLS (ç¨³å®šæ€§) â‰¤ 0.1 âœ…
        </div>
        
        <div id="alert-display" style="margin: 10px 0; padding: 10px; border-radius: 5px;">
            ç­‰å¾…æ£€æµ‹ç»“æœ...
        </div>
        
        <button onclick="triggerSlowLoading()">ğŸŒ æ¨¡æ‹Ÿç½‘é¡µåŠ è½½æ…¢</button>
        <button onclick="triggerLayoutShift()">ğŸ“ æ¨¡æ‹Ÿé¡µé¢æŠ–åŠ¨</button>
    </div>
    
    <div class="demo-section">
        <h3>3. ğŸ“ˆ å®æ—¶ç›‘æ§æ—¥å¿—</h3>
        <p>å°±åƒæŠ¤å£«è®°å½•ç—…äººçš„ä½“å¾å˜åŒ–ï¼š</p>
        
        <div class="monitor-display" id="log-display">
            [ç­‰å¾…ç›‘æ§æ•°æ®...]
        </div>
        
        <button onclick="clearLog()">ğŸ§¹ æ¸…ç©ºè®°å½•</button>
        <button onclick="generateReport()">ğŸ“‹ ç”ŸæˆæŠ¥å‘Š</button>
    </div>
    
    <div class="analogy-box">
        <h3>ğŸ¤” ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªç³»ç»Ÿï¼Ÿ</h3>
        <ul>
            <li><strong>é¢„é˜²èƒœäºæ²»ç–—</strong>ï¼šå°±åƒå®šæœŸä½“æ£€èƒ½æ—©å‘ç°ç–¾ç—…ï¼Œæ€§èƒ½ç›‘æ§èƒ½æ—©å‘ç°ç½‘ç«™é—®é¢˜</li>
            <li><strong>24å°æ—¶å®ˆæŠ¤</strong>ï¼šå°±åƒICUç›‘æŠ¤ä»ªä¸é—´æ–­ç›‘æµ‹ï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿä¹Ÿåœ¨24å°æ—¶å®ˆæŠ¤ç½‘ç«™</li>
            <li><strong>æ•°æ®è¯´è¯</strong>ï¼šå°±åƒåŒ»ç”Ÿçœ‹åŒ–éªŒå•è¯Šæ–­ï¼Œæˆ‘ä»¬çœ‹æ€§èƒ½æ•°æ®ä¼˜åŒ–ç½‘ç«™</li>
        </ul>
    </div>
    
    <script type="module">
        import { performanceMonitor } from './js/performance-monitor.js';
        
        let logMessages = [];
        
        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            logMessages.push(logEntry);
            
            if (logMessages.length > 10) {
                logMessages = logMessages.slice(-10);
            }
            
            updateLogDisplay();
        }
        
        function updateLogDisplay() {
            const logDisplay = document.getElementById('log-display');
            logDisplay.textContent = logMessages.join('\n');
        }
        
        // å…¨å±€å‡½æ•°
        window.checkVitals = function() {
            const vitalsDisplay = document.getElementById('vitals-display');
            const metrics = performanceMonitor.getMetrics();
            const cwv = metrics.coreWebVitals;
            
            let display = 'ğŸ¥ ç½‘ç«™å¥åº·æ£€æŸ¥æŠ¥å‘Šï¼š\n\n';
            
            // LCP - å°±åƒå¿ƒç‡
            const lcp = cwv.LCP.value;
            if (lcp !== null) {
                const status = lcp <= 2500 ? 'âœ… æ­£å¸¸' : lcp <= 4000 ? 'âš ï¸ éœ€æ³¨æ„' : 'ğŸš¨ å¼‚å¸¸';
                display += `ğŸ’“ å¿ƒç‡ (LCP): ${lcp.toFixed(0)}ms ${status}\n`;
            } else {
                display += `ğŸ’“ å¿ƒç‡ (LCP): æ­£åœ¨æµ‹é‡...\n`;
            }
            
            // FID - å°±åƒååº”é€Ÿåº¦
            const fid = cwv.FID.value;
            if (fid !== null) {
                const status = fid <= 100 ? 'âœ… æ­£å¸¸' : fid <= 300 ? 'âš ï¸ éœ€æ³¨æ„' : 'ğŸš¨ å¼‚å¸¸';
                display += `âš¡ ååº”é€Ÿåº¦ (FID): ${fid.toFixed(0)}ms ${status}\n`;
            } else {
                display += `âš¡ ååº”é€Ÿåº¦ (FID): ç­‰å¾…ç”¨æˆ·äº¤äº’...\n`;
            }
            
            // CLS - å°±åƒè¡€å‹ç¨³å®šæ€§
            const cls = cwv.CLS.value;
            if (cls !== null) {
                const status = cls <= 0.1 ? 'âœ… æ­£å¸¸' : cls <= 0.25 ? 'âš ï¸ éœ€æ³¨æ„' : 'ğŸš¨ å¼‚å¸¸';
                display += `ğŸ©¸ ç¨³å®šæ€§ (CLS): ${cls.toFixed(3)} ${status}\n`;
            } else {
                display += `ğŸ©¸ ç¨³å®šæ€§ (CLS): æ­£åœ¨ç›‘æµ‹...\n`;
            }
            
            display += `\nğŸ“Š ç»¼åˆå¥åº·è¯„åˆ†: ${metrics.performanceScore}/100`;
            
            vitalsDisplay.textContent = display;
            addLog('ğŸ” è¿›è¡Œäº†ä¸€æ¬¡å¥åº·æ£€æŸ¥');
        };
        
        window.simulateEmergency = function() {
            addLog('ğŸš¨ æ¨¡æ‹Ÿç´§æ€¥æƒ…å†µï¼šç½‘ç«™å“åº”å˜æ…¢ï¼');
            
            // æ¨¡æ‹Ÿé•¿ä»»åŠ¡ï¼ˆå°±åƒç—…äººå¿ƒç‡çªç„¶åŠ å¿«ï¼‰
            const start = performance.now();
            while (performance.now() - start < 200) {
                // é˜»å¡ä¸»çº¿ç¨‹200ms
            }
            
            const alertDisplay = document.getElementById('alert-display');
            alertDisplay.style.background = '#f8d7da';
            alertDisplay.style.color = '#721c24';
            alertDisplay.innerHTML = 'ğŸš¨ <strong>ç´§æ€¥è­¦æŠ¥</strong>ï¼šæ£€æµ‹åˆ°é•¿ä»»åŠ¡æ‰§è¡Œï¼ä¸»çº¿ç¨‹è¢«é˜»å¡200ms';
            
            setTimeout(() => {
                alertDisplay.style.background = '#d4edda';
                alertDisplay.style.color = '#155724';
                alertDisplay.innerHTML = 'âœ… <strong>æ¢å¤æ­£å¸¸</strong>ï¼šç³»ç»Ÿå·²æ¢å¤æ­£å¸¸è¿è¡Œ';
                addLog('âœ… ç´§æ€¥æƒ…å†µå·²è§£é™¤');
            }, 3000);
        };
        
        window.triggerSlowLoading = function() {
            addLog('ğŸŒ æ¨¡æ‹Ÿæ…¢åŠ è½½ï¼šå°±åƒç—…äººå‘çƒ§ä½“æ¸©å‡é«˜');
            
            // åˆ›å»ºä¸€ä¸ªå¤§å›¾ç‰‡æ¥æ¨¡æ‹Ÿæ…¢åŠ è½½
            const img = new Image();
            img.onload = () => {
                addLog('ğŸ“¸ å¤§å›¾ç‰‡åŠ è½½å®Œæˆï¼Œå¯èƒ½å½±å“LCPæŒ‡æ ‡');
                checkVitals();
            };
            img.src = `https://picsum.photos/1200/800?random=${Date.now()}`;
            
            const alertDisplay = document.getElementById('alert-display');
            alertDisplay.style.background = '#fff3cd';
            alertDisplay.style.color = '#856404';
            alertDisplay.innerHTML = 'âš ï¸ <strong>æ³¨æ„</strong>ï¼šæ£€æµ‹åˆ°å¤§èµ„æºåŠ è½½ï¼Œå¯èƒ½å½±å“é¡µé¢æ€§èƒ½';
        };
        
        window.triggerLayoutShift = function() {
            addLog('ğŸ“ æ¨¡æ‹Ÿå¸ƒå±€åç§»ï¼šå°±åƒç—…äººè¡€å‹ä¸ç¨³å®š');
            
            // åŠ¨æ€æ·»åŠ å†…å®¹é€ æˆå¸ƒå±€åç§»
            const newDiv = document.createElement('div');
            newDiv.style.cssText = `
                height: 100px;
                background: #ffeb3b;
                margin: 10px 0;
                padding: 20px;
                border-radius: 5px;
                animation: slideDown 0.5s ease-out;
            `;
            newDiv.textContent = 'è¿™æ˜¯çªç„¶å‡ºç°çš„å†…å®¹ï¼Œä¼šé€ æˆå¸ƒå±€åç§»ï¼ˆå°±åƒè¡€å‹çªç„¶å‡é«˜ï¼‰';
            
            // æ·»åŠ åŠ¨ç”»æ ·å¼
            if (!document.getElementById('slide-animation')) {
                const style = document.createElement('style');
                style.id = 'slide-animation';
                style.textContent = `
                    @keyframes slideDown {
                        from { height: 0; padding: 0; opacity: 0; }
                        to { height: 100px; padding: 20px; opacity: 1; }
                    }
                `;
                document.head.appendChild(style);
            }
            
            document.body.appendChild(newDiv);
            
            const alertDisplay = document.getElementById('alert-display');
            alertDisplay.style.background = '#f8d7da';
            alertDisplay.style.color = '#721c24';
            alertDisplay.innerHTML = 'ğŸš¨ <strong>å¸ƒå±€åç§»è­¦æŠ¥</strong>ï¼šæ£€æµ‹åˆ°é¡µé¢å¸ƒå±€ä¸ç¨³å®šï¼';
            
            // 3ç§’åç§»é™¤
            setTimeout(() => {
                newDiv.remove();
                addLog('ğŸ“ å¸ƒå±€åç§»æµ‹è¯•å®Œæˆ');
                checkVitals();
            }, 3000);
        };
        
        window.clearLog = function() {
            logMessages = [];
            updateLogDisplay();
            addLog('ğŸ§¹ æŠ¤å£«æ¸…ç©ºäº†è®°å½•æœ¬');
        };
        
        window.generateReport = function() {
            const metrics = performanceMonitor.getMetrics();
            const report = `
ğŸ“‹ ç½‘ç«™å¥åº·ä½“æ£€æŠ¥å‘Š
===================
æ£€æŸ¥æ—¶é—´: ${new Date().toLocaleString()}
ç»¼åˆè¯„åˆ†: ${metrics.performanceScore}/100

ç”Ÿå‘½ä½“å¾è¯¦æƒ…:
â€¢ å¿ƒç‡ (LCP): ${metrics.coreWebVitals.LCP.value ? metrics.coreWebVitals.LCP.value.toFixed(0) + 'ms' : 'æœªæµ‹é‡'}
â€¢ ååº” (FID): ${metrics.coreWebVitals.FID.value ? metrics.coreWebVitals.FID.value.toFixed(0) + 'ms' : 'æœªæµ‹é‡'}
â€¢ ç¨³å®š (CLS): ${metrics.coreWebVitals.CLS.value ? metrics.coreWebVitals.CLS.value.toFixed(3) : 'æœªæµ‹é‡'}

ç›‘æ§ç»Ÿè®¡:
â€¢ é•¿ä»»åŠ¡æ¬¡æ•°: ${metrics.longTasksCount}
â€¢ èµ„æºç›‘æ§æ•°: ${metrics.resourceTimingsCount}
â€¢ ç”¨æˆ·äº¤äº’æ•°: ${metrics.userExperienceMetrics.interactionCount}

å»ºè®®:
${metrics.performanceScore >= 90 ? 'âœ… ç½‘ç«™å¥åº·çŠ¶å†µä¼˜ç§€ï¼' : 
  metrics.performanceScore >= 70 ? 'âš ï¸ ç½‘ç«™å¥åº·è‰¯å¥½ï¼Œæœ‰æ”¹è¿›ç©ºé—´' : 
  'ğŸš¨ ç½‘ç«™å¥åº·éœ€è¦é‡ç‚¹å…³æ³¨å’Œä¼˜åŒ–'}
            `.trim();
            
            console.log(report);
            alert('ğŸ“‹ ä½“æ£€æŠ¥å‘Šå·²ç”Ÿæˆï¼è¯·æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°è·å–è¯¦ç»†ä¿¡æ¯ã€‚');
            addLog('ğŸ“‹ ç”Ÿæˆäº†è¯¦ç»†çš„å¥åº·ä½“æ£€æŠ¥å‘Š');
        };
        
        // åˆå§‹åŒ–
        setTimeout(() => {
            addLog('ğŸ¥ æ€§èƒ½ç›‘æ§ç³»ç»Ÿå·²å¯åŠ¨ï¼Œå¼€å§‹24å°æ—¶ç›‘æŠ¤');
            addLog('ğŸ’¡ ç‚¹å‡»æŒ‰é’®ä½“éªŒä¸åŒçš„ç›‘æ§åŠŸèƒ½');
            checkVitals();
        }, 1000);
        
        // å®šæœŸæ£€æŸ¥ï¼ˆå°±åƒæŠ¤å£«å®šæ—¶æŸ¥æˆ¿ï¼‰
        setInterval(() => {
            if (document.visibilityState === 'visible') {
                checkVitals();
            }
        }, 10000);
        
        console.log('ğŸ¯ æ€§èƒ½ç›‘æ§åŸç†æ¼”ç¤ºé¡µé¢å·²åŠ è½½');
        console.log('ğŸ’¡ è¿™ä¸ªç³»ç»Ÿå°±åƒåŒ»é™¢çš„ç›‘æŠ¤è®¾å¤‡ï¼Œ24å°æ—¶å®ˆæŠ¤æ‚¨çš„ç½‘ç«™å¥åº·ï¼');
    </script>
</body>
</html>