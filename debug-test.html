<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸»é¢˜åˆ‡æ¢è°ƒè¯•æµ‹è¯•</title>
    
    <!-- å¼•å…¥å®é™…çš„CSSæ–‡ä»¶ -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/base.css">
    
    <style>
        .debug-container {
            max-width: 1000px;
            margin: 2rem auto;
            padding: 2rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--background-primary);
            color: var(--text-primary);
        }
        
        .debug-section {
            margin: 2rem 0;
            padding: 1rem;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: var(--background-card);
        }
        
        .debug-info {
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            background: var(--background-code);
            padding: 1rem;
            border-radius: 4px;
            margin: 1rem 0;
            white-space: pre-wrap;
        }
        
        .test-button {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            margin: 0.5rem;
            transition: background-color 0.3s ease;
        }
        
        .test-button:hover {
            background: var(--primary-hover);
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-ok { background: #28a745; }
        .status-error { background: #dc3545; }
        .status-warning { background: #ffc107; }
        
        .console-output {
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 0.8rem;
            background: var(--background-code);
            padding: 1rem;
            border-radius: 4px;
            border: 1px solid var(--border-color);
        }
        
        .console-line {
            margin-bottom: 4px;
            padding: 2px 4px;
            border-radius: 2px;
        }
        
        .console-error { background: rgba(220, 53, 69, 0.1); color: #dc3545; }
        .console-warn { background: rgba(255, 193, 7, 0.1); color: #856404; }
        .console-info { background: rgba(23, 162, 184, 0.1); color: #0c5460; }
        .console-log { background: rgba(40, 167, 69, 0.1); color: #155724; }
    </style>
</head>
<body>
    <!-- å¤åˆ¶å®é™…ç½‘ç«™çš„headerç»“æ„ -->
    <header class="header">
        <div class="header-container">
            <div class="logo">
                <div class="logo-title"><a href="/" data-i18n="site_title">Screen Size Checker</a></div>
            </div>
            <nav class="main-nav">
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a href="/" class="nav-link" data-i18n="nav_home">é¦–é¡µ</a>
                    </li>
                </ul>
            </nav>
            <div class="header-controls">
                <button class="language-button" id="language-modal-trigger" aria-label="Select language">
                    <span class="language-icon">ğŸŒ</span>
                    <span class="language-text" data-i18n="language_select_label">Language</span>
                </button>
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon">â˜€ï¸</span>
                </button>
            </div>
        </div>
    </header>

    <div class="debug-container">
        <h1>ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½è°ƒè¯•æµ‹è¯•</h1>
        <p>è¿™ä¸ªé¡µé¢ç”¨äºè°ƒè¯•ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½ï¼Œä½¿ç”¨å®é™…çš„CSSå’ŒJavaScriptæ–‡ä»¶ã€‚</p>
        
        <div class="debug-section">
            <h3>ğŸ¯ å½“å‰çŠ¶æ€</h3>
            <p><span class="status-indicator" id="theme-status"></span>å½“å‰ä¸»é¢˜ï¼š<strong id="current-theme">æ£€æµ‹ä¸­...</strong></p>
            <p><span class="status-indicator" id="button-status"></span>æŒ‰é’®ç‚¹å‡»æ¬¡æ•°ï¼š<strong id="click-count">0</strong></p>
            <p><span class="status-indicator" id="js-status"></span>JavaScriptçŠ¶æ€ï¼š<strong id="js-load-status">åŠ è½½ä¸­...</strong></p>
            <p><span class="status-indicator" id="event-status"></span>äº‹ä»¶ç»‘å®šçŠ¶æ€ï¼š<strong id="event-bind-status">æ£€æµ‹ä¸­...</strong></p>
        </div>
        
        <div class="debug-section">
            <h3>ğŸ” è¯¦ç»†è°ƒè¯•ä¿¡æ¯</h3>
            <div class="debug-info" id="debug-details">æ£€æµ‹ä¸­...</div>
        </div>
        
        <div class="debug-section">
            <h3>ğŸ§ª æµ‹è¯•æ§åˆ¶</h3>
            <button class="test-button" onclick="manualToggleTheme()">æ‰‹åŠ¨åˆ‡æ¢ä¸»é¢˜</button>
            <button class="test-button" onclick="resetTheme()">é‡ç½®ä¸ºæµ…è‰²ä¸»é¢˜</button>
            <button class="test-button" onclick="updateDebugInfo()">åˆ·æ–°è°ƒè¯•ä¿¡æ¯</button>
            <button class="test-button" onclick="testEventBinding()">æµ‹è¯•äº‹ä»¶ç»‘å®š</button>
            <button class="test-button" onclick="clearConsole()">æ¸…ç©ºæ§åˆ¶å°</button>
        </div>
        
        <div class="debug-section">
            <h3>ğŸ“Š æ§åˆ¶å°è¾“å‡º</h3>
            <div class="console-output" id="console-output">
                <div class="console-line console-info">[å¯åŠ¨] è°ƒè¯•é¡µé¢å·²åŠ è½½</div>
            </div>
        </div>
    </div>

    <!-- å¼•å…¥å®é™…çš„JavaScriptæ–‡ä»¶ -->
    <script type="module" src="js/app.js"></script>
    
    <script>
        let clickCount = 0;
        let loadTime = Date.now();
        let consoleMessages = [];
        
        // æ‹¦æˆªconsoleæ–¹æ³•ä»¥æ˜¾ç¤ºåœ¨é¡µé¢ä¸Š
        const originalConsole = {
            log: console.log,
            error: console.error,
            warn: console.warn,
            info: console.info
        };
        
        function interceptConsole() {
            ['log', 'error', 'warn', 'info'].forEach(method => {
                console[method] = function(...args) {
                    originalConsole[method].apply(console, args);
                    
                    const message = args.map(arg => 
                        typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
                    ).join(' ');
                    
                    addConsoleMessage(method, message);
                };
            });
        }
        
        function addConsoleMessage(type, message) {
            const timestamp = new Date().toLocaleTimeString();
            consoleMessages.push({ type, message, timestamp });
            
            // ä¿æŒæœ€æ–°çš„50æ¡æ¶ˆæ¯
            if (consoleMessages.length > 50) {
                consoleMessages.shift();
            }
            
            updateConsoleDisplay();
        }
        
        function updateConsoleDisplay() {
            const consoleDiv = document.getElementById('console-output');
            if (consoleDiv) {
                consoleDiv.innerHTML = consoleMessages.map(msg => 
                    `<div class="console-line console-${msg.type}">[${msg.timestamp}] ${msg.message}</div>`
                ).join('');
                consoleDiv.scrollTop = consoleDiv.scrollHeight;
            }
        }
        
        function clearConsole() {
            consoleMessages = [];
            updateConsoleDisplay();
            console.info('æ§åˆ¶å°å·²æ¸…ç©º');
        }
        
        // æ›´æ–°è°ƒè¯•ä¿¡æ¯
        function updateDebugInfo() {
            try {
                const dataThemeValue = document.documentElement.getAttribute('data-theme') || 'æœªè®¾ç½®';
                const localStorageTheme = localStorage.getItem('theme') || 'æœªè®¾ç½®';
                const computedBg = getComputedStyle(document.body).backgroundColor;
                const computedColor = getComputedStyle(document.body).color;
                const buttonCount = document.querySelectorAll('#theme-toggle').length;
                const themeButton = document.getElementById('theme-toggle');
                
                // æ›´æ–°çŠ¶æ€æŒ‡ç¤ºå™¨
                document.getElementById('current-theme').textContent = dataThemeValue === 'dark' ? 'æ·±è‰²ä¸»é¢˜' : 'æµ…è‰²ä¸»é¢˜';
                document.getElementById('click-count').textContent = clickCount;
                document.getElementById('js-load-status').textContent = typeof window.initializeApp === 'function' ? 'å·²åŠ è½½' : 'æœªåŠ è½½';
                
                // æ£€æŸ¥äº‹ä»¶ç»‘å®šçŠ¶æ€
                let eventStatus = 'æœªç»‘å®š';
                if (themeButton) {
                    const listeners = getEventListeners ? getEventListeners(themeButton) : null;
                    if (listeners && listeners.click && listeners.click.length > 0) {
                        eventStatus = 'å·²ç»‘å®š';
                    } else if (themeButton.onclick) {
                        eventStatus = 'å·²ç»‘å®š(onclick)';
                    } else {
                        eventStatus = 'æœªç»‘å®š';
                    }
                }
                document.getElementById('event-bind-status').textContent = eventStatus;
                
                // æ›´æ–°çŠ¶æ€æŒ‡ç¤ºå™¨é¢œè‰²
                document.getElementById('theme-status').className = `status-indicator ${dataThemeValue !== 'æœªè®¾ç½®' ? 'status-ok' : 'status-error'}`;
                document.getElementById('button-status').className = `status-indicator ${clickCount > 0 ? 'status-ok' : 'status-warning'}`;
                document.getElementById('js-status').className = `status-indicator ${typeof window.initializeApp === 'function' ? 'status-ok' : 'status-error'}`;
                document.getElementById('event-status').className = `status-indicator ${eventStatus.includes('å·²ç»‘å®š') ? 'status-ok' : 'status-error'}`;
                
                // è¯¦ç»†è°ƒè¯•ä¿¡æ¯
                const debugDetails = `
ä¸»é¢˜å±æ€§ (data-theme): ${dataThemeValue}
æœ¬åœ°å­˜å‚¨ä¸»é¢˜: ${localStorageTheme}
è®¡ç®—æ ·å¼èƒŒæ™¯è‰²: ${computedBg}
è®¡ç®—æ ·å¼æ–‡å­—è‰²: ${computedColor}
ä¸»é¢˜åˆ‡æ¢æŒ‰é’®æ•°é‡: ${buttonCount}
äº‹ä»¶ç»‘å®šçŠ¶æ€: ${eventStatus}
é¡µé¢åŠ è½½æ—¶é—´: ${Date.now() - loadTime}ms
å½“å‰URL: ${window.location.href}
ç”¨æˆ·ä»£ç†: ${navigator.userAgent.substring(0, 100)}...
                `.trim();
                
                document.getElementById('debug-details').textContent = debugDetails;
                
                console.log('è°ƒè¯•ä¿¡æ¯å·²æ›´æ–°:', {
                    dataTheme: dataThemeValue,
                    localStorage: localStorageTheme,
                    buttonCount,
                    eventStatus,
                    computedBg,
                    computedColor
                });
            } catch (error) {
                console.error('æ›´æ–°è°ƒè¯•ä¿¡æ¯æ—¶å‡ºé”™:', error);
            }
        }
        
        // æ‰‹åŠ¨ä¸»é¢˜åˆ‡æ¢å‡½æ•°
        function manualToggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            
            console.log(`æ‰‹åŠ¨åˆ‡æ¢ä¸»é¢˜: ${currentTheme} -> ${newTheme}`);
            
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            
            // æ›´æ–°ä¸»é¢˜å›¾æ ‡
            const themeIcon = document.querySelector('.theme-icon');
            if (themeIcon) {
                themeIcon.textContent = newTheme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
            }
            
            clickCount++;
            updateDebugInfo();
        }
        
        // é‡ç½®ä¸»é¢˜
        function resetTheme() {
            console.log('é‡ç½®ä¸»é¢˜åˆ°æµ…è‰²');
            document.documentElement.setAttribute('data-theme', 'light');
            localStorage.setItem('theme', 'light');
            
            const themeIcon = document.querySelector('.theme-icon');
            if (themeIcon) {
                themeIcon.textContent = 'ğŸŒ™';
            }
            
            updateDebugInfo();
        }
        
        // æµ‹è¯•äº‹ä»¶ç»‘å®š
        function testEventBinding() {
            const themeButton = document.getElementById('theme-toggle');
            if (themeButton) {
                console.log('æµ‹è¯•ä¸»é¢˜åˆ‡æ¢æŒ‰é’®ç‚¹å‡»...');
                themeButton.click();
                setTimeout(() => {
                    console.log('æŒ‰é’®ç‚¹å‡»æµ‹è¯•å®Œæˆ');
                    updateDebugInfo();
                }, 100);
            } else {
                console.error('æ‰¾ä¸åˆ°ä¸»é¢˜åˆ‡æ¢æŒ‰é’®');
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            console.log('è°ƒè¯•é¡µé¢DOMåŠ è½½å®Œæˆ');
            interceptConsole();
            
            // ç­‰å¾…app.jsåŠ è½½å®Œæˆ
            setTimeout(() => {
                updateDebugInfo();
                
                // ç›‘å¬ä¸»é¢˜åˆ‡æ¢æŒ‰é’®ç‚¹å‡»
                const themeButton = document.getElementById('theme-toggle');
                if (themeButton) {
                    // æ·»åŠ é¢å¤–çš„ç‚¹å‡»ç›‘å¬å™¨æ¥è®¡æ•°
                    themeButton.addEventListener('click', () => {
                        console.log('ä¸»é¢˜åˆ‡æ¢æŒ‰é’®è¢«ç‚¹å‡» (è°ƒè¯•ç›‘å¬å™¨)');
                        clickCount++;
                        setTimeout(updateDebugInfo, 100);
                    });
                    console.log('è°ƒè¯•ç›‘å¬å™¨å·²æ·»åŠ åˆ°ä¸»é¢˜åˆ‡æ¢æŒ‰é’®');
                } else {
                    console.error('æ‰¾ä¸åˆ°ä¸»é¢˜åˆ‡æ¢æŒ‰é’®');
                }
                
                // å®šæœŸæ›´æ–°è°ƒè¯•ä¿¡æ¯
                setInterval(updateDebugInfo, 5000);
                
                console.log('è°ƒè¯•ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ');
            }, 1000);
        });
        
        // ç›‘å¬ä¸»é¢˜å˜åŒ–
        const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                if (mutation.type === 'attributes' && mutation.attributeName === 'data-theme') {
                    const newTheme = mutation.target.getAttribute('data-theme');
                    console.log(`æ£€æµ‹åˆ°ä¸»é¢˜å±æ€§å˜åŒ–: ${newTheme}`);
                    updateDebugInfo();
                }
            });
        });
        
        observer.observe(document.documentElement, {
            attributes: true,
            attributeFilter: ['data-theme']
        });
        
        // é¡µé¢å¯è§æ€§å˜åŒ–æ—¶æ›´æ–°è°ƒè¯•ä¿¡æ¯
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden) {
                console.log('é¡µé¢é‡æ–°å¯è§ï¼Œæ›´æ–°è°ƒè¯•ä¿¡æ¯');
                updateDebugInfo();
            }
        });
    </script>
</body>
</html>