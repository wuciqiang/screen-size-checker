<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resource Loading Optimizer Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .stats {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 3px;
            font-family: monospace;
        }
        button {
            padding: 10px 15px;
            margin: 5px;
            border: none;
            border-radius: 3px;
            background: #007cba;
            color: white;
            cursor: pointer;
        }
        button:hover {
            background: #005a87;
        }
        .log {
            background: #000;
            color: #0f0;
            padding: 10px;
            border-radius: 3px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>Resource Loading Optimizer Test</h1>
    
    <div class="test-section">
        <h2>Device Capabilities</h2>
        <div id="device-info" class="stats">Loading...</div>
    </div>
    
    <div class="test-section">
        <h2>Network Information</h2>
        <div id="network-info" class="stats">Loading...</div>
    </div>
    
    <div class="test-section">
        <h2>Loading Statistics</h2>
        <div id="loading-stats" class="stats">Loading...</div>
        <button onclick="updateStats()">Refresh Stats</button>
    </div>
    
    <div class="test-section">
        <h2>Test Actions</h2>
        <button onclick="testForceLoad()">Force Load Test Resource</button>
        <button onclick="testAddCritical()">Add Critical Resource</button>
        <button onclick="testAddDeferred()">Add Deferred Resource</button>
        <button onclick="clearLog()">Clear Log</button>
    </div>
    
    <div class="test-section">
        <h2>Console Log</h2>
        <div id="console-log" class="log"></div>
    </div>

    <script type="module">
        import { resourceLoadingOptimizer } from './js/resource-loading-optimizer.js';
        
        // Override console.log to capture logs
        const originalLog = console.log;
        const originalWarn = console.warn;
        const originalError = console.error;
        
        function addToLog(message, type = 'log') {
            const logDiv = document.getElementById('console-log');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#f00' : type === 'warn' ? '#ff0' : '#0f0';
            logDiv.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addToLog(args.join(' '), 'log');
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addToLog(args.join(' '), 'warn');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addToLog(args.join(' '), 'error');
        };
        
        // Initialize the optimizer
        async function initTest() {
            console.log('üß™ Starting Resource Loading Optimizer Test');
            
            try {
                await resourceLoadingOptimizer.initialize();
                updateDisplays();
                
                // Update stats every 5 seconds
                setInterval(updateStats, 5000);
                
            } catch (error) {
                console.error('Failed to initialize test:', error);
            }
        }
        
        function updateDisplays() {
            // Update device info
            const deviceInfo = resourceLoadingOptimizer.deviceCapabilities;
            document.getElementById('device-info').innerHTML = `
                <strong>Performance Tier:</strong> ${deviceInfo.performanceTier}<br>
                <strong>Memory:</strong> ${deviceInfo.memory}GB<br>
                <strong>CPU Cores:</strong> ${deviceInfo.cores}<br>
                <strong>Is Mobile:</strong> ${deviceInfo.isMobile}<br>
                <strong>Is Low End:</strong> ${deviceInfo.isLowEnd}<br>
                <strong>Connection Type:</strong> ${deviceInfo.connectionType}<br>
                <strong>Downlink:</strong> ${deviceInfo.downlink}Mbps<br>
                <strong>RTT:</strong> ${deviceInfo.rtt}ms
            `;
            
            // Update network info
            const networkInfo = resourceLoadingOptimizer.networkInfo;
            document.getElementById('network-info').innerHTML = `
                <strong>Effective Type:</strong> ${networkInfo.effectiveType}<br>
                <strong>Downlink:</strong> ${networkInfo.downlink}Mbps<br>
                <strong>RTT:</strong> ${networkInfo.rtt}ms<br>
                <strong>Save Data:</strong> ${networkInfo.saveData}
            `;
            
            updateStats();
        }
        
        function updateStats() {
            const stats = resourceLoadingOptimizer.getLoadingStats();
            document.getElementById('loading-stats').innerHTML = `
                <strong>Total Resources:</strong> ${stats.totalResources}<br>
                <strong>Loaded Resources:</strong> ${stats.loadedResources}<br>
                <strong>Active Requests:</strong> ${stats.activeRequests}<br>
                <strong>Queued Requests:</strong> ${stats.queuedRequests}<br>
                <strong>Max Concurrent:</strong> ${stats.maxConcurrentRequests}
            `;
        }
        
        // Test functions
        window.updateStats = updateStats;
        
        window.testForceLoad = async function() {
            console.log('üß™ Testing force load...');
            try {
                await resourceLoadingOptimizer.forceLoadResource('css/test-resource.css');
                console.log('‚úÖ Force load test completed');
            } catch (error) {
                console.error('‚ùå Force load test failed:', error);
            }
            updateStats();
        };
        
        window.testAddCritical = function() {
            console.log('üß™ Testing add critical resource...');
            resourceLoadingOptimizer.addCriticalResource('js/test-critical.js');
            updateStats();
        };
        
        window.testAddDeferred = function() {
            console.log('üß™ Testing add deferred resource...');
            resourceLoadingOptimizer.addDeferredResource('js/test-deferred.js');
            updateStats();
        };
        
        window.clearLog = function() {
            document.getElementById('console-log').innerHTML = '';
        };
        
        // Start the test
        initTest();
    </script>
</body>
</html>