<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>性能优化测试页面</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .status { padding: 5px 10px; margin: 5px 0; border-radius: 3px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <h1>性能优化功能测试</h1>
    
    <div class="test-section">
        <h2>设备检测测试</h2>
        <div id="device-test-results">
            <div class="status info">正在测试设备检测功能...</div>
        </div>
        <p>屏幕分辨率: <span id="screen-resolution-display">
            <span data-i18n="screen_resolution">屏幕分辨率</span>: <span data-i18n="detecting">检测中...</span>
        </span></p>
        <p>视口尺寸: <span id="viewport-display" data-i18n="detecting">检测中...</span></p>
    </div>
    
    <div class="test-section">
        <h2>国际化测试</h2>
        <div id="i18n-test-results">
            <div class="status info">正在测试国际化功能...</div>
        </div>
        <p data-i18n="device_info_title">设备信息</p>
        <button id="test-language-switch">切换到英文</button>
    </div>
    
    <div class="test-section">
        <h2>内链系统测试</h2>
        <div id="internal-links-test-results">
            <div class="status info">正在测试内链系统...</div>
        </div>
        <div id="internal-links-container">
            <div class="status info">加载中...</div>
        </div>
    </div>

    <!-- 加载必要的库 -->
    <script src="https://unpkg.com/i18next@23.7.16/dist/umd/i18next.min.js"></script>
    <script src="https://unpkg.com/i18next-http-backend@2.4.2/dist/umd/i18nextHttpBackend.min.js"></script>
    <script src="https://unpkg.com/i18next-browser-languagedetector@7.2.0/dist/umd/i18nextBrowserLanguageDetector.min.js"></script>

    <script type="module">
        // 测试设备检测功能
        async function testDeviceDetection() {
            try {
                const { updateDisplay } = await import('./js/device-detector.js');
                await updateDisplay();
                
                document.getElementById('device-test-results').innerHTML = 
                    '<div class="status success">✅ 设备检测功能正常</div>';
            } catch (error) {
                document.getElementById('device-test-results').innerHTML = 
                    `<div class="status error">❌ 设备检测失败: ${error.message}</div>`;
                console.error('Device detection test failed:', error);
            }
        }

        // 测试国际化功能
        async function testI18n() {
            try {
                const { initializeI18next, updateUIElements } = await import('./js/i18n.js');
                await initializeI18next();
                updateUIElements();
                
                document.getElementById('i18n-test-results').innerHTML = 
                    '<div class="status success">✅ 国际化功能正常</div>';
                
                // 设置语言切换测试
                document.getElementById('test-language-switch').addEventListener('click', async () => {
                    const currentLang = i18next.language;
                    const newLang = currentLang === 'zh' ? 'en' : 'zh';
                    await i18next.changeLanguage(newLang);
                    updateUIElements();
                    document.getElementById('test-language-switch').textContent = 
                        newLang === 'zh' ? '切换到英文' : 'Switch to Chinese';
                });
                
            } catch (error) {
                document.getElementById('i18n-test-results').innerHTML = 
                    `<div class="status error">❌ 国际化失败: ${error.message}</div>`;
                console.error('I18n test failed:', error);
            }
        }

        // 测试内链系统
        async function testInternalLinks() {
            try {
                const { initializeInternalLinks } = await import('./js/internal-links.js');
                await initializeInternalLinks();
                
                // 等待一段时间让内链加载
                setTimeout(() => {
                    const container = document.getElementById('internal-links-container');
                    if (container && container.children.length > 1) {
                        document.getElementById('internal-links-test-results').innerHTML = 
                            '<div class="status success">✅ 内链系统正常</div>';
                    } else {
                        document.getElementById('internal-links-test-results').innerHTML = 
                            '<div class="status error">❌ 内链系统未加载内容</div>';
                    }
                }, 2000);
                
            } catch (error) {
                document.getElementById('internal-links-test-results').innerHTML = 
                    `<div class="status error">❌ 内链系统失败: ${error.message}</div>`;
                console.error('Internal links test failed:', error);
            }
        }

        // 运行所有测试
        async function runTests() {
            console.log('开始运行性能优化测试...');
            
            await testDeviceDetection();
            await testI18n();
            await testInternalLinks();
            
            console.log('所有测试完成');
        }

        // 页面加载完成后运行测试
        document.addEventListener('DOMContentLoaded', runTests);
    </script>
</body>
</html>